select * from 
(select distinct productid,customerid from orders)a inner join 
(select distinct productid,customerid from orders)b 
on a.productid = b.productid
order by a.customerid


select productid,count(a.customerid) from
(select customerid from orders where productid =77) a 
inner join 
orders b on a.customerid = b.customerid
where productid<>77


____________________________________________________________
____________________________________________________________

select productid,count(*) from
(select customerid from orders where productid =24) a 
inner join 
orders b on a.customerid = b.customerid
group by productid

INSERT INTO orders VALUES(832,'Jul  4 2014 12:00:00:000AM',300,77,12.10,12);
INSERT INTO orders VALUES(833,'Aug  4 2014 12:00:00:000AM',300,5,17.10,1);
INSERT INTO orders VALUES(834,'Sep  4 2014 12:00:00:000AM',300,21,12.10,2);
INSERT INTO orders VALUES(835,'Jan  4 2014 12:00:00:000AM',300,24,12.10,20);
INSERT INTO orders VALUES(836,'Feb  4 2014 12:00:00:000AM',300,26,14.10,23);


INSERT INTO orders VALUES(837,'Mar  4 2014 12:00:00:000AM',8903,77,12.10,12);
INSERT INTO orders VALUES(838,'Apr  4 2014 12:00:00:000AM',8903,5,17.10,1);
INSERT INTO orders VALUES(839,'May  4 2014 12:00:00:000AM',8903,21,12.10,2);


INSERT INTO orders VALUES(840,'Jun  4 2014 12:00:00:000AM',1256,77,12.10,20);
INSERT INTO orders VALUES(841,'Jul  4 2014 12:00:00:000AM',1256,5,14.10,23);

____________________________________________________________
____________________________________________________________
select productid,count(*) from
(select customerid from orders where productid =76) a 
inner join 
orders b on a.customerid = b.customerid
group by productid

INSERT INTO orders VALUES(842,'Jul  4 2014 12:00:00:000AM',1570,11,40.10,20);
INSERT INTO orders VALUES(843,'Aug  4 2014 12:00:00:000AM',1570,14,30.10,30);
INSERT INTO orders VALUES(844,'Sep  4 2014 12:00:00:000AM',1570,16,80.10,40);
INSERT INTO orders VALUES(845,'Jan  4 2014 12:00:00:000AM',1570,31,20.10,50);



INSERT INTO orders VALUES(846,'Jan  4 2014 12:00:00:000AM',1770,11,22.10,12);
INSERT INTO orders VALUES(847,'Feb  4 2014 12:00:00:000AM',1770,14,33.10,1);
INSERT INTO orders VALUES(848,'Mar  4 2014 12:00:00:000AM',1770,16,44.10,2);


INSERT INTO orders VALUES(849,'Jun  4 2014 12:00:00:000AM',530,11,18.10,20);
INSERT INTO orders VALUES(850,'Jul  4 2014 12:00:00:000AM',530,14,19.10,23);

____________________________________________________________
____________________________________________________________

select productid,count(*) from
(select customerid from orders where productid =75) a 
inner join 
orders b on a.customerid = b.customerid
group by productid

INSERT INTO orders VALUES(851,'Jan  1 2014 12:00:00:000AM',648,14,40.10,20);
INSERT INTO orders VALUES(852,'Feb  2 2014 12:00:00:000AM',648,14,30.10,30);
INSERT INTO orders VALUES(853,'Mar  3 2014 12:00:00:000AM',648,72,80.10,40);
INSERT INTO orders VALUES(854,'Apr  4 2014 12:00:00:000AM',648,72,20.10,50);



INSERT INTO orders VALUES(855,'May  5 2014 12:00:00:000AM',1020,14,22.10,12);
INSERT INTO orders VALUES(856,'Jun  6 2014 12:00:00:000AM',1020,21,33.10,1);
INSERT INTO orders VALUES(857,'Jul  7 2014 12:00:00:000AM',1020,72,44.10,2);


INSERT INTO orders VALUES(858,'Aug  8 2014 12:00:00:000AM',1020,21,18.10,20);
INSERT INTO orders VALUES(859,'Sep  9 2014 12:00:00:000AM',656,14,19.10,23);

____________________________________________________________
____________________________________________________________

select productid,count(*) from
(select customerid from orders where productid =71) a 
inner join 
orders b on a.customerid = b.customerid
group by productid

INSERT INTO orders VALUES(860,'Oct  1 2014 12:00:00:000AM',1632,8,50.10,20);
INSERT INTO orders VALUES(861,'Nov  2 2014 12:00:00:000AM',1632,15,50.10,30);
INSERT INTO orders VALUES(862,'Dec  3 2014 12:00:00:000AM',1820,15,30.10,40);
INSERT INTO orders VALUES(863,'Jan  4 2014 12:00:00:000AM',1820,51,50.10,50);



INSERT INTO orders VALUES(864,'Feb  5 2014 12:00:00:000AM',1820,8,33.10,12);
INSERT INTO orders VALUES(865,'Mar  6 2014 12:00:00:000AM',1292,51,43.10,1);
INSERT INTO orders VALUES(857,'Apr  7 2014 12:00:00:000AM',1292,51,54.10,2);


INSERT INTO orders VALUES(866,'May  8 2014 12:00:00:000AM',1292,8,48.10,20);
INSERT INTO orders VALUES(867,'Jun  9 2014 12:00:00:000AM',102,51,69.10,23);
____________________________________________________________
____________________________________________________________


select productid,count(*) from
(select customerid from orders where productid =70) a 
inner join 
orders b on a.customerid = b.customerid
group by productid

INSERT INTO orders VALUES(868,'Oct  1 2014 12:00:00:000AM',1620,21,50.10,20);
INSERT INTO orders VALUES(869,'Nov  2 2014 12:00:00:000AM',1620,14,50.10,30);
INSERT INTO orders VALUES(870,'Dec  3 2014 12:00:00:000AM',1620,32,30.10,40);
INSERT INTO orders VALUES(871,'Jan  4 2014 12:00:00:000AM',1620,21,50.10,50);



INSERT INTO orders VALUES(872,'Feb  5 2014 12:00:00:000AM',2179,21,33.10,12);
INSERT INTO orders VALUES(873,'Mar  6 2014 12:00:00:000AM',2179,14,43.10,1);
INSERT INTO orders VALUES(874,'Apr  7 2014 12:00:00:000AM',2179,32,54.10,2);


INSERT INTO orders VALUES(875,'May  8 2014 12:00:00:000AM',802,21,48.10,20);
INSERT INTO orders VALUES(876,'Jun  9 2014 12:00:00:000AM',802,14,69.10,23);

____________________________________________________________
____________________________________________________________


select productid,count(*) from
(select customerid from orders where productid =69) a 
inner join 
orders b on a.customerid = b.customerid
group by productid

INSERT INTO orders VALUES(877,'Dec  8 2014 12:00:00:000AM',2208,16,50.10,20);
INSERT INTO orders VALUES(878,'Nov  7 2014 12:00:00:000AM',2208,23,50.10,30);
INSERT INTO orders VALUES(879,'Oct  6 2014 12:00:00:000AM',226,28,30.10,40);
INSERT INTO orders VALUES(880,'Sep  5 2014 12:00:00:000AM',226,45,50.10,50);


INSERT INTO orders VALUES(881,'Jan  4 2014 12:00:00:000AM',226,45,33.10,12);
INSERT INTO orders VALUES(882,'Feb  3 2014 12:00:00:000AM',959,45,43.10,1);
INSERT INTO orders VALUES(883,'Mar  2 2014 12:00:00:000AM',959,28,54.10,2);


INSERT INTO orders VALUES(884,'Aug  1 2014 12:00:00:000AM',959,16,48.10,20);
INSERT INTO orders VALUES(885,'Jul  10 2014 12:00:00:000AM',226,23,69.10,23);

____________________________________________________________
____________________________________________________________


select productid,count(*) from
(select customerid from orders where productid =11) a 
inner join 
orders b on a.customerid = b.customerid
group by productid

INSERT INTO orders VALUES(886,'Dec  18 2014 12:00:00:000AM',280,16,26.5,30);

INSERT INTO orders VALUES(886,'Dec  18 2014 12:00:00:000AM',280,16,50.10,20);
INSERT INTO orders VALUES(887,'Nov  17 2014 12:00:00:000AM',990,23,50.10,30);
INSERT INTO orders VALUES(889,'Oct  16 2014 12:00:00:000AM',1852,28,30.10,40);
INSERT INTO orders VALUES(890,'Sep  15 2014 12:00:00:000AM',843,45,50.10,50);


INSERT INTO orders VALUES(891,'Jan  14 2014 12:00:00:000AM',1622,45,33.10,12);
INSERT INTO orders VALUES(892,'Feb  13 2014 12:00:00:000AM',1106,45,43.10,1);
INSERT INTO orders VALUES(893,'Mar  12 2014 12:00:00:000AM',959,28,54.10,2);


INSERT INTO orders VALUES(894,'Aug  11 2014 12:00:00:000AM',1106,16,48.10,20);
INSERT INTO orders VALUES(895,'Jul  10 2014 12:00:00:000AM',2394,23,69.10,23);








drop table if exists order_1;
create table order_1  as select o.id,orderdate,CustomerId,ProductId,UnitPrice,Quantity from
orders o 
inner join orderitem b on o.id=b.id


drop table if exists product_1;
create table product_1 as 
select b.id,b.ProductName,b.SupplierId,a.new_unit as UnitPrice,b.Package,b.IsDiscontinued from
(select   productid,min(a.unitprice)  as new_unit from order_1 a inner join product b on a.productid = b.id group by productid) a 
inner join product b
on a.productid=b.id;





-------most profitable product, supplier for each sale_month

select *,  str_to_date(trim(concat(substr(orderdate,8,4),'-',
                case when substr(orderdate,1,3) = 'jan' then '01'
                when substr(orderdate,1,3) = 'feb' then '02'
                when substr(orderdate,1,3) = 'mar' then '03'
                when substr(orderdate,1,3) = 'apr' then '04'
                when substr(orderdate,1,3) = 'may' then '05'
                when substr(orderdate,1,3) = 'jun' then '06'
                when substr(orderdate,1,3) = 'jul' then '07'
                when substr(orderdate,1,3) = 'aug' then '08'
                when substr(orderdate,1,3) = 'sep' then '09'
                when substr(orderdate,1,3) = 'oct' then '10'
                when substr(orderdate,1,3) = 'nov' then '11'
                when substr(orderdate,1,3) = 'dec' then '12'
                end ,'-',
                case when length(trim(substr(orderdate,5,2))) = 1 then  concat('0',trim(substr(orderdate,5,2))) else substr(orderdate,5,2) end )),'%Y-%m-%d') from 
             orders limit 5;



select *, substr(orderdate,1,3) from order_1 a inner 




